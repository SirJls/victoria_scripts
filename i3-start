#!/usr/bin/env sh

while :; do
  wp=$($SCRIPTS/wallpaper | sed -r 's/(^|$)/\1"/g')
  eval "feh --randomize --bg-fill $wp"
  sleep 10
done &

while ((1)); do
  DAWN_TIME=$(( 8 * 60 ))
  DUSK_TIME=$(( 20 * 60 ))
  WARNING="IMPORTANT: DO NOT EDIT THIS FILE, IT WILL BE OVERWRITTEN!"

  hours=$(date +%H)
  minutes=$(date +%M)
  total=$(( ${hours#0} * 60 + ${minutes#0} ))

  if (( $total < $DUSK_TIME)) && (( $total < $DAWN_TIME )); then
    # night configuration
    printf "%s\n\n" $WARNING > $XDG_CONFIG_HOME/i3/config
    cat $XDG_CONFIG_HOME/i3/config_night >> $XDG_CONFIG_HOME/i3/config
    i3-msg -q reload
  elif (( $total >= $DAWN_TIME )) && (( $total < $DUSK_TIME )); then
    # day configuration
    printf "%s\n\n" $WARNING > $XDG_CONFIG_HOME/i3/config
    cat $XDG_CONFIG_HOME/i3/config_day >> $XDG_CONFIG_HOME/i3/config
    i3-msg -q reload
  else
    # night configuration
    printf "%s\n\n" $WARNING > $XDG_CONFIG_HOME/i3/config
    cat $XDG_CONFIG_HOME/i3/config_night >> $XDG_CONFIG_HOME/i3/config
    i3-msg -q reload
  fi
  sleep 1
done &

/usr/bin/i3 &> /dev/null
